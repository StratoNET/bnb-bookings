{{template "admin" .}}

{{define "page-title"}}
  Reservations Calendar
{{end}}

{{define "content"}}

  <div class="clearfix">
    <a class="btn btn-outline-secondary float-start" 
    href="/admin/reservations-calendar?y={{index .StringMap "prev_month_year"}}&m={{index .StringMap "prev_month"}}">
    <i class="fas fa-backward"></i></a>
    <a class="btn btn-outline-secondary float-end" 
    href="/admin/reservations-calendar?y={{index .StringMap "next_month_year"}}&m={{index .StringMap "next_month"}}">
    <i class="fas fa-forward"></i></a>
    <div class="text-center h3">
      {{index .StringMap "show_month"}} {{index .StringMap "this_month_year"}}
    </div>
  </div>

  {{$rooms := index .Data "rooms"}}
  {{$dim := index .IntMap "days_in_month"}}
  {{$currentMonth := index .StringMap "this_month"}}
  {{$currentYear := index .StringMap "this_month_year"}}

  <form method="post" action="/admin/reservations-calendar" novalidate>
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">

    <div class="mt-5">
      {{range $rooms}}

        {{$roomID := .ID}}
        {{$blocked := index $.Data (printf "blocked_map_%d" .ID)}}
        {{$reservations := index $.Data (printf "reservations_map_%d" .ID)}}

        <div class="h5 mb-2">
          {{.RoomName}}
        </div>

        <div class="table-responsive">
          <table class="table table-bordered table-sm mb-5">
            <tr class="table-success">
              {{range $days := iterateDays $dim}}
                <td class="text-center">
                  {{$days}}
                </td>
              {{end}}
            </tr>
            <tr>
              {{range $days := iterateDays $dim}}
              <td class="text-center">
                {{if gt (index $reservations (printf "%d-%s-%s" $days $currentMonth $currentYear)) 0}}
                  <a href="/admin/reservations/cal/{{index $reservations (printf "%d-%s-%s" $days $currentMonth $currentYear)}}">
                    <span class="fw-bold text-danger">R</span>
                  </a>
                {{else}}
                  <input 
                    {{if gt (index $blocked (printf "%d-%s-%s" $days $currentMonth $currentYear)) 0}}
                      checked
                      name="remove_blocked_{{$roomID}}_{{printf "%d-%s-%s" $days $currentMonth $currentYear}}"
                      value="{{index $blocked (printf "%d-%s-%s" $days $currentMonth $currentYear)}}"
                    {{else}}
                      name="add_blocked_{{$roomID}}_{{printf "%d-%s-%s" $days $currentMonth $currentYear}}"
                    {{end}}
                      type="checkbox">
                {{end}}
              </td>
              {{end}}
            </tr>
          </table>
        </div>
      {{end}}
    </div>

    <hr>

    <input type="submit" class="btn btn-primary" value="Save Changes">

  </form>

{{end}}